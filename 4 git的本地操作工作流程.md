## 4 git的本地操作工作流程

从此节开始，进入git的操作和使用介绍。

### 4.1 本地仓库

#### 4.1.1 工作流程

git本地操作的三个区域：

![git本地操作的三个区域](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587733424686.png)

工作流程：

![git工作流程](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587733969272.png)

[^为什么一定要有暂存区？]: 暂存区可以一次性将文件全部上传到仓库中，类似于购物车可以一键下单的功能。



#### 4.1.2 本地仓库操作

简单理解，仓库（repository）就是一个用于存放代码的目录。仓库里面所有的文件都可以被git管理，每个文件的修改、删除等都能被git跟踪到



**1.在安装好首次使用需要先进行全局配置**

在桌面空白处单击鼠标右键，点击"git bash here"，打开git窗口。

```git
$git config --global user.name "用户名"
$git config --global user.email "邮箱"
```

设置用户名和邮箱时，推荐与github的用户名和邮箱一致。

去掉"用户名"或者"邮箱"则可以在git中打印用户名和邮箱。

![全局配置演示](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587734956917.png)



**2.创建仓库**

当我们想让git管理某个新项目，或者已存在项目的时候，就需要创建仓库。创建仓库时候使用的目录不一定要求是空目录，非空目录也是可以的。但是，不建议在现有项目上学习git，因为初学时有可能造成不可挽回的后果。

创建文件夹的时候不要出现中文。

（思考：如何进入不同文件夹创建仓库？）

```git
$mkdir git_note
```

![成功创建目录](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587738640120.png)

已经成功创建目录

接着，进入项目目录

```git
$cd git_note
```

![进入项目目录](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587738688857.png)

然后，进行git仓库的初始化

**只有进行初始化，git才知道，它需要管理这个目录**

```git
$git init
```

![git仓库初始化](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587738822970.png)

此时，git_note文件夹中，就出现了.git文件夹（目录）（该文件是隐藏文件，可通过“此电脑”中的“查看”设置显示隐藏的项目）**注意，此文件夹不能删除，也不能随意更改其中的内容。**

![成功创建.git文件](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587738908896.png)

**以上操作，同一项目，只需要做一次就可以了**





**3.git常用指令操作**

- git status     查看当前状态（非必要）

![status示例](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587793165610.png)

- git add 文件名     添加到缓存区

  git add可以添加一个文件，也可以同时添加多个文件。

  **语法1**：git add 文件名

  **语法2**：git add 文件名1 文件名2 文件名3 ……

  **语法3**： git add .          （添加当前**目录**到缓存区中）

![add示例](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587793229939.png)

[^注]: 文件名和目录尽量不要用中文，此处是为了测试文件名为中文时是否出现bug，故意使用中文文件名。

- git commit -m"注释内容"     提交至版本库

注释内容可以记录本次提交的具体内容，可作为日志使用，可使用中文。

![commit示例](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587793316474.png)

[^注]: 此处\346\226\260\345\273\272\346\226\207\346\234\254\346\226\207\346\241\243.txt即为上文中新建文本文档.txt。



此时，提交好的文件保存在本地仓库中。



#### 4.1.3 版本回退——开发者的“后悔药”

版本回退分为两步骤进行操作：

**1.查看版本，确定需要回到的时间点。**

​	语法指令： git log

​						git log --pretty=oneline （推荐用第二个）



使用git log：

![log示例](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587793637860.png)

commit后的编码就是根据提交时间生成的commit id（或者叫版本号）。

HEAD -> master表示此条是最新的提交操作。

author和date表示提交的作者和时间。

readme是本次提交的注释。



使用git log --pretty=oneline：

![log --pretty=oneline示例](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587793772716.png)

此时，每行就是一个时间点，前方是根据时间点生成的commit id，中间是表示此条是最新操作，最后是注释。



**两种log指令都只能看到当前版本之前的版本号。假设当前版本是版本5，如果进行回退到版本1，回退后，那么无法直接看到版本1之后的版本号。**

如果想回到版本1之后，再回到版本5，那么：

此时，有两种解决方式：

​	1.如果没有关闭窗口，则参考上面的历史信息。

​	2.如果关闭了窗口，则可以通过git reflog可以查看历史操作。

![reflog示例](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587794427942.png)

此处截取视频中的示例作为演示。

再根据git reflog中的版本号和注释进行回退操作。



**2.回退操作**

​	语法指令：git reset --hard 版本号（即根据时间点生成的特殊编码）

![reset示例](4%20git%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.assets/1587794054813.png)

此处截取视频中的示例作为演示。





**即：**

- 要想回到过去，必须先得到commit id（版本号），然后通过git reset --hard 进行回退。
- 要想回到未来，需要使用git reflog进行历史操作查询，得到自己想要的commit id。
- 再写回退指令的时候，commit id可以不用写全，git可以自动识别，但也不能太少，至少要写前四位。